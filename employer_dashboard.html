<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="employer_dashboard.css" />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <title></title>
  </head>
  <body>
    <div class="main_sec">
      <div class="nav-item nav-link" id="invt">
          <h4>Invite link:</h4>
          <a id="invite_link" class="invite_link"onclick="redirect()"></a> </div>
      <nav>
        <div class="nav nav-tabs mnk" id="nav-tab" >
          <a class="nav-item nav-link active set" id="nav-info-tab" data-toggle="tab" href="#nav-info"
          aria-controls="nav-info" aria-selected="true">Dashboard</a>
          <a class="nav-item nav-link set" id="nav-view-tab" data-toggle="tab" href="#nav-view"
          aria-controls="nav-view" aria-selected="false">View</a>
          <a class="nav-item nav-link set" id="nav-Create-tab" data-toggle="tab" href="#nav-Create"
            aria-controls="nav-Create" aria-selected="false">Create Interview</a>
          <a class="nav-item nav-link set" id="nav-Interviewer-tab" data-toggle="tab" href="#nav-Interviewer"
            aria-controls="nav-Interviewer" aria-selected="false">Interviewer</a>
          <a class="nav-item nav-link set" id="logout" onclick='logout()' href="#">Logout</a>
        </div>
        <div class="nav nav-tabs nav-dd" id="nav-tab" ><div class="line"></div><div class="line"></div><div class="line"></div>
          <a class="nav-item nav-link active set1" id="nav-info-tab" data-toggle="tab" href="#nav-info"
          aria-controls="nav-info" aria-selected="true">Dashboard</a>
          <a class="nav-item nav-link set1" id="nav-view-tab" data-toggle="tab" href="#nav-view"
          aria-controls="nav-view" aria-selected="false">View</a>
          <a class="nav-item nav-link set1" id="nav-Create-tab" data-toggle="tab" href="#nav-Create"
            aria-controls="nav-Create" aria-selected="false">Create Interview</a>
          <a class="nav-item nav-link set1" id="nav-Interviewer-tab" data-toggle="tab" href="#nav-Interviewer"
            aria-controls="nav-Interviewer" aria-selected="false">Interviewer</a>
          <a class="nav-item nav-link set1" id="logout" onclick='logout()' href="#">Logout</a>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-info" role="tabpanel" aria-labelledby="nav-view-tab">
          <div id="company_info">
        </div></div>
        <div class="tab-pane fade" id="nav-view" role="tabpanel" aria-labelledby="nav-view-tab">
          <div class='filters'>
            <label>Filter By: </label>
            <div class="filter_dd">
            <select id="Fil_source">
              <option value="" selected>Source</option>
              <option>company website</option>
              <option>Social Media</option>
              <option>College</option>
              <option>Company Employee</option>
              <option>Other</option>
            </select>
            <select id="Fil_status">
              <option value="" selected>Application Status</option>
              <option>Shortlisted</option>
              <option>Not Seen</option>
              <option>Rejected</option>
              <option>In-process</option>
              <option>On hold</option>
            </select>
          </div>
          </div>
          <table id='tableexp'>
            <thead>
              <tr>
                <th>Name</th>
                <th>Applied For</th>
                <th>Source</th>
                <th>Application Status</th>
                <th>Email</th>
                <th>Phone No.</th>
                <th>Current Designation</th>
                <th>Feedback</th>
                <th>Address</th>
                <th>Current CTC</th>
                <th>Expected CTC</th>
                <th>Notice Period</th>
                <th>Skills</th>
                <th>CV link</th>
              </tr>
            </thead>

            <tbody id="tableData"></tbody>
          </table>
          <button onclick="exportTableToExcel('tableexp')" class="Button">Download To Excel</button>
        </div>
        <div
          class="tab-pane fade"
          id="nav-Create"
          role="tabpanel"
          aria-labelledby="nav-Create-tab"
        >
          <form>
            <div class="form-group">
              <label for="post">Vacancy for</label>
              <input
                type="text"
                class="form-control"
                id="vac_for"
                placeholder="Vacancy for Post..."
                required
              />
            </div>
            <div class="form-group">
              <label for="post">No. of Vacancy</label>
              <input
                type="number"
                class="form-control"
                id="no_v"
                placeholder="no.."
              />
            </div>
            <div class="form-group">
              <label for="skills">Skills</label>
              <input
                type="text"
                class="form-control"
                id="skills_req"
                placeholder="Skills required..."
              />
            </div>
            <label for="post">Date</label>
            <div class="form-group date_time">
              <div class="box">
                <label for="post">From</label>
                <input type="date" id="d_from" class="form-control" required />
              </div>
              <div class="box">
                <label for="post">To</label>
                <input type="date" id="d_to" class="form-control" required />
              </div>
            </div>
            <label for="post">Time</label>
            <div class="form-group date_time">
              <div class="box">
                <label for="post">From</label>
                <input type="time" id="t_from" class="form-control" required />
              </div>
              <div class="box">
                <label for="post">To</label>
                <input type="time" id="t_to" class="form-control" required />
              </div>
            </div>
            <button type="submit" id="btn" class="Button">
              Submit
            </button>
          </form>
        </div>
        <div
          class="tab-pane fade"
          id="nav-Interviewer"
          role="tabpanel"
          aria-labelledby="nav-Interviewer-tab"
        >
          <ul class="nav nav-pills Interview" id="pills-tab" role="tablist">
            <li class="nav-item">
              <a
                class="nav-link active"
                id="create-tab"
                data-toggle="pill"
                href="#create"
                role="tab"
                aria-controls="pills-home"
                aria-selected="true"
                >Create</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                id="Manage-tab"
                data-toggle="pill"
                href="#Manage"
                role="tab"
                aria-controls="pills-profile"
                aria-selected="false"
                >Manage</a
              >
            </li>
          </ul>
          <div class="tab-content" id="pills-tabContent">
            <div
              class="tab-pane fade show active"
              id="create"
              role="tabpanel"
              aria-labelledby="create-tab"
            >
              <form>
                <div class="form-group">
                  <label for="Email">Email address</label>
                  <input
                    type="email"
                    class="form-control"
                    required
                    id="int_email"
                    aria-describedby="emailHelp"
                    placeholder="Enter email"
                  />
                </div>
                <div class="form-group">
                  <label for="Post">Post Applied for </label>
                  <select class="form-control" id="jb_av" required>
                    <option value="" selected disabled>Please select</option>
                  </select>
                </div>
                <button type="submit" id="Interviewer_btn" class="Button">Create</button>
              </form>
            </div>
            <div class="tab-pane fade"  id="Manage"  role="tabpanel"  aria-labelledby="Manage-tabtab">
              <table>
              <thead>
                <tr>

                  <th>Email</th>
                  <th>Profiles</th>
                  <th>Action</th>
                </tr>
              </thead>

              <tbody id="interviewer_data"></tbody>
            </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body><script>
  let invite_page = (window.location.protocol + "//" + window.location.host + "/interview-management/invite_page.html");
   document.getElementById('invite_link').innerHTML = invite_page;
   function redirect() {
     window.location.href= invite_page;

   }
    if(localStorage.getItem('token') == null) {
      var emp_log = (window.location.protocol + "//" + window.location.host + "/interview-management/employer_login.html");
       window.location.replace(emp_log);
    }
  </script>
  <script>
    function exportTableToExcel(tableexp, filename = ''){
    var downloadLink;
    var dataType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
    var tableSelect = document.getElementById(tableexp);
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

    // Specify file name
    filename = filename?filename+'.xls':'excel_data.xls';

    // Create download link element
    downloadLink = document.createElement("a");

    document.body.appendChild(downloadLink);

    if(navigator.msSaveOrOpenBlob){
        var blob = new Blob(['\ufeff', tableHTML], {
            type: dataType
        });

        navigator.msSaveOrOpenBlob( blob, filename);
    }else{
        // Create a link to the file
        downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

        // Setting the file name
        downloadLink.download = filename;

        //triggering the function
        downloadLink.click();
    }
}
  </script>
  <script>
  const info ={
    method:"GET",
    headers: {
      authorization: "bearer " + localStorage.getItem("token")
    }
  };
    fetch("https://hr502.herokuapp.com/company/get/information",info)
      .then(function(response) {
        return response.json();
      }).then(function(text){
        console.log(text.Details);

        const C_info = document.getElementById("company_info");
        let cHtml = "";
        var c_Data = text.Details[0];
        console.log(c_Data);
              cHtml +=
              "<p>Company Name: " + c_Data.name +
              "</p><p>HR Name: " + c_Data.hrFirstName + " "+c_Data.hrLastName +
              "</p><p>Email: " +  c_Data.email +
              "</p><p>mobileNo: " + c_Data.mobileNo +
              "</p><p>Address: " +c_Data.address +"</p>"
        console.log(cHtml);

        C_info.innerHTML = cHtml;


  })
  </script>
  <script>
    let itvr_data = [];

    const add_itvr = (ev) => {
      ev.preventDefault();
      let ids = {
        email: document.getElementById("int_email").value,
        profile: document.getElementById("jb_av").value
      };
      emp_data.push(ids);

      console.warn("added", { itvr_data });
      const opt = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          authorization: "bearer " + localStorage.getItem("token"),
        },
        body: JSON.stringify(ids),
      };
      fetch("https://hr502.herokuapp.com/company/add/interviewer", opt)
        .then(function (response) {
          return response.json();
        })
        .then(function (text) {
          console.log(text);
          console.log(text.msg);
          console.log(localStorage.getItem("token"));
          if(text.msg === "Email is sent"){
            alert("Mail is sent to interviewer");
          }
          else{
            alert("Fill all the inputs");
          }
        });
    };
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("Interviewer_btn").addEventListener("click", add_itvr);
    });
  </script>
  <script>
    let emp_data = [];

    const add_emp = (ev) => {
      ev.preventDefault(); //to stop the form submitting
      let details = {
        jobName: document.getElementById("vac_for").value,
        vacancy: document.getElementById("no_v").value,
        skills: document.getElementById("skills_req").value,
        datefrom: document.getElementById("d_from").value,
        dateto: document.getElementById("d_to").value,
        timefrom: document.getElementById("t_from").value,
        timeto: document.getElementById("t_to").value,
      };
      emp_data.push(details);

      console.warn("added", { emp_data });
      const options = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          authorization: "bearer " + localStorage.getItem("token"),
        },
        body: JSON.stringify(details),
      };
      fetch("https://hr502.herokuapp.com/addJobs", options)
        .then(function (response) {
          return response.json();
        })
        .then(function (text) {
          console.log(text);
          console.log(localStorage.getItem("token"));
           let errString = ("Please enter following fields: \n");
          if(typeof(text.msg) === 'undefined' )
           {
            for(let err of text.errors){
            console.log(err.msg);
            errString += err.msg +", ";
          }
             alert(errString);
           }
           else{
             alert(text.msg);

           }
          getJob();
        });
    };
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("btn").addEventListener("click", add_emp);
    });
    function logout() {
      window.localStorage.removeItem('token');
      window.localStorage.removeItem('companyId');
      var emp_log = (window.location.protocol + "//" + window.location.host + "/interview-management/employer_login.html");
      window.location.replace(emp_log);
    }
  </script>
  <script>
  window.onload = getJob();
 function getJob() {
    const ddown = {
      method: "GET",
    };
    fetch(
      "https://hr502.herokuapp.com/comapanyjobs" +
        localStorage.getItem("companyId"),
      ddown
    )
      .then(function (response) {
        return response.json();
      })
      .then(function (text) {
        console.log(text.length);
        let arr = [];
        for (let i = 0; i < text.length; i++) {
          arr.push(text[i].jobName);
        }
        console.log(arr);
        document.getElementById("jb_av").options.length=1;
        for (const val of arr) {
          var option = document.createElement("option");
          option.value = val;
          option.text = val;
          document.getElementById("jb_av").appendChild(option);
        }
      });
}
  </script>
  <script>
    var activities = document.getElementById("Fil_source");
    var activitie = document.getElementById("Fil_status");
    activities.addEventListener("change", function () {
      renderData();
    });
    activitie.addEventListener("change", function () {
      renderData();
    });
	   window.onload = () => {
            renderData();
             interviewer_table();
          };
    function renderData() {
      const tbl = {
        method: "GET",
        headers: {
          authorization: "bearer " + localStorage.getItem("token"),
        },
      };
      fetch("https://hr502.herokuapp.com/visiter", tbl)
        .then(function (response) {
          return response.json();
        })
        .then(function (text) {
          console.log(text);
          window.onload = () => {
            loadTableData(text);
          };
          loadTableData(text);
          function loadTableData(text, selectedSource) {
            const tableBody = document.getElementById("tableData");
            let dataHtml = "";
            for (let person of text) {
              if (
                person.source === document.getElementById("Fil_source").value && person.status === document.getElementById("Fil_status").value
              ) {
                console.log('source yes status yes ');
                dataHtml +=
                  "<tr><td>" +
                  person.fname +
                  " " +
                  person.lname +
                  "</td><td>" +
                  person.jobName +
                  "</td><td>" +
                  person.source +
                  "</td><td>" +
                  person.status +
                  "</td><td>" +
                  person.email +
                  "</td><td>" +
                  person.mobileNo +  "</td><td>" +person.currentDesignation +"</td><td>" + person.feedback +
                  "</td><td>" +
                  person.address +
                  "</td><td>" +
                  person.cCTC +
                  "</td><td>" +
                  person.eCTC +
                  "</td><td>" +
                  person.noticePeriod +
                  "</td><td>" +
                  person.skills +
                  "</td><td>" +
                  `<a href='${person._id}'>OpenCV</a>` +
                  "</td></tr>";
              }  else if (
                person.source === document.getElementById("Fil_source").value && document.getElementById("Fil_status").value === ""
              ) {
                console.log('source yes status no ');
                dataHtml +=
                "<tr><td>" +
                person.fname +
                " " +
                person.lname +
                "</td><td>" +
                person.jobName +
                "</td><td>" +
                person.source +
                "</td><td>" +
                person.status +
                "</td><td>" +
                person.email +
                "</td><td>" +
                person.mobileNo +  "</td><td>" +person.currentDesignation +"</td><td>" + person.feedback +
                "</td><td>" +
                person.address +
                "</td><td>" +
                person.cCTC +
                "</td><td>" +
                person.eCTC +
                "</td><td>" +
                person.noticePeriod +
                "</td><td>" +
                person.skills +
                "</td><td>" +
              `<a href='${person.resumeUrl}'>OpenCV</a>` +
                "</td></tr>";
              }
              else if (
                document.getElementById("Fil_source").value === "" &&  person.status === document.getElementById("Fil_status").value
              ) {
                console.log('source no status yes ');
                dataHtml +=
                "<tr><td>" +
                person.fname +
                " " +
                person.lname +
                "</td><td>" +
                person.jobName +
                "</td><td>" +
                person.source +
                "</td><td>" +
                person.status +
                "</td><td>" +
                person.email +
                "</td><td>" +
                person.mobileNo +  "</td><td>" +person.currentDesignation +"</td><td>" + person.feedback +
                "</td><td>" +
                person.address +
                "</td><td>" +
                person.cCTC +
                "</td><td>" +
                person.eCTC +
                "</td><td>" +
                person.noticePeriod +
                "</td><td>" +
                person.skills +
                "</td><td>" +
                `<a href='${person.resumeUrl}'>OpenCV</a>` +
                "</td></tr>";
              }
              else if (
                document.getElementById("Fil_source").value === "" && document.getElementById("Fil_status").value === ""
              ) { console.log('source no status no ');
                dataHtml +=
                "<tr><td>" +
                person.fname +
                " " +
                person.lname +
                "</td><td>" +
                person.jobName +
                "</td><td>" +
                person.source +
                "</td><td>" +
                person.status +
                "</td><td>" +
                person.email +
                "</td><td>" +
                person.mobileNo +  "</td><td>" +person.currentDesignation +"</td><td>" + person.feedback +
                "</td><td>" +
                person.address +
                "</td><td>" +
                person.cCTC +
                "</td><td>" +
                person.eCTC +
                "</td><td>" +
                person.noticePeriod +
                "</td><td>" +
                person.skills +
                "</td><td>" +
                `<a href='${person.resumeUrl}'>OpenCV</a>` +
                "</td></tr>";
              }
            }
            console.log(dataHtml);
            console.log(document.getElementById("Fil_source").value);
            tableBody.innerHTML = dataHtml;
          }
        });
    }
  </script>








  <script>

  function interviewer_table() {

  const intv_table = {
    method: "GET",
    headers: {
      authorization: "bearer " + localStorage.getItem("token"),
    },
  };
  fetch("https://hr502.herokuapp.com/company/get/interviewers", intv_table)
    .then(function (response) {
      return response.json();
    })
    .then(function (text) {
      console.log(text);
      console.log(text.interviewer);
      window.onload = () => {
        loadTableData(text_tbl);
      };
      var text_tbl = text.interviewer;
      loadTableData(text_tbl);
      function loadTableData(text_tbl, selectedSource) {
        const tableBody = document.getElementById("interviewer_data");
        let data_Html = "";
        for (let person of text_tbl) {
  console.log(text);
  console.log(person._id);
              data_Html +=
              "<tr><td>" + person.email + "</td><td>" + person.profile
              +`</td><td><button class='delete' id="dlt_btn" data=${person._id} onclick='dlt(this)'>Delete</button></td><tr>`;
          }
        console.log(data_Html);

        tableBody.innerHTML = data_Html;
      }
    });}
  </script>











  <script>
  var dlt_id;
  function dlt(id) {
dlt_id = id.getAttribute("data");
console.log(dlt_id);
let dlt_data=[];
    let ids = {

      id: dlt_id
    };
    dlt_data.push(ids);

    console.warn("added", { dlt_data });
    const opt = {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        authorization: "bearer " + localStorage.getItem("token"),
      },
      body: JSON.stringify(ids),
    };
    fetch("https://hr502.herokuapp.com/company/delete/interviewer", opt)
      .then(function (response) {
        return response.json();
      })
      .then(function (text) {
        console.log(text);
        if(text.status === 'OK'){
           interviewer_table();
        }

      });

};
  </script>
</html>
