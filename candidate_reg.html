<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="employer_reg.css">
    <title>Registation Page</title>
  </head>
  <body>

    <form id="main">
      <h1 class="title">Candidate Registation</h1>
      <div class="form-group">
          <label for="fn">First Name</label>
          <input type="text" class="form-control" id="fn" placeholder="Enter First Name" required>
      </div>
      <div class="form-group">
          <label for="ln">Last Name</label>
          <input type="text" class="form-control" id="ln" placeholder="Enter Last Name" required>
     </div>
     <div class="form-group">
          <label for="exampleInputEmail1">Email address</label>
          <input type="email" class="form-control" required id="email" aria-describedby="emailHelp" placeholder="Enter email">
          <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
    </div>
    <div class="form-group">
        <label for="Address" >Current Address</label>
        <textarea class="form-control" placeholder="Address.." id="address" required rows="3"></textarea>
    </div>

    <div class="form-group">
        <label for="Post">Post Applied for </label>
        <select class="form-control" id="jb_av" required>
          <option value="" selected disabled>Please select</option>
        </select>
    </div>

    <div class="form-group">
        <label for="Source">Source</label>
        <select class="form-control" required id='source'>
          <option value="" selected disabled>Please select</option>
          <option>company website</option>
          <option>Social Media</option>
          <option>College</option>
          <option>Company Employee</option>
          <option>Other</option>
        </select>
    </div>

    <div class="form-group">
          <label for="Current Designation">Current Designation</label>
          <input type="text" class="form-control" id="cd" placeholder="Designation if any.." required>
    </div>
    <div class="form-group">
          <label for="Current_ctc">Current CTC</label>
          <input type="Text" class="form-control" id="cCTC" placeholder="if any">
    </div>
    <div class="form-group">
          <label for="Expected_ctc">Expected CTC</label>
          <input type="Text" class="form-control" id="eCTC"  placeholder="if any">
    </div>
    <div class="form-group">
    <label for="notice_period">Notice Period</label>
    <select class="form-control" id="np" required>
       <option value="" selected disabled>Please select</option>
      <option>Negotiable</option>
      <option>Non-Negotiable</option>
    </select>
  </div>
  <div class="form-group">
      <label for="Skills" >Key Skills </label>
      <textarea class="form-control" id="skills" placeholder="Skills.." required rows="3"></textarea>
  </div>
    <div class="form-group">
          <label for="Cv">Upload CV</label>
          <input type="text"  id="cv" class="form-control" placeholder="Enter the cv link" required>
    </div>

    <button type="submit" id='btn' class="button"  >Verify Email</button>
  </form>
  <script>
  var getToken = window.location.search.slice(1);
const options ={
  method:"GET"
};
  fetch("https://hr502.herokuapp.com/comapanyjobs"+ getToken.substring(getToken.indexOf('=') + 1),options)
    .then(function(response) {
      return response.json();
    }).then(function(text){
      console.log(text);
      console.log(text.length);
      let arr = [];
      for(let i=0;i<text.length;i++)
      {
        arr.push(text[i].jobName);
      }
      console.log(arr);
      for (const val of arr) {
        var option = document.createElement("option");
        option.value = val;
        option.text = val;
        document.getElementById("jb_av").appendChild(option);
      }

})
</script>
<script>
console.log(getToken);
console.log(getToken.substring(getToken.indexOf('=') + 1));
  let emp_data = [];

  const add_emp = (ev)=>{
      ev.preventDefault();  //to stop the form submitting
      let details = {
          'fname': document.getElementById('fn').value,
          'lname': document.getElementById('ln').value,
          'email':document.getElementById('email').value,
          'address':document.getElementById('address').value,
          'jobName':document.getElementById('jb_av').value,
          'source':document.getElementById('source').value,
          'currentDesignation':document.getElementById('cd').value,
          'cCTC':document.getElementById('cCTC').value,
          'eCTC':document.getElementById('eCTC').value,
          'noticePeriod':document.getElementById('np').value,
          'skills':document.getElementById('skills').value,
          'resumeUrl':document.getElementById('cv').value,
          'companyId':getToken.substring(getToken.indexOf('=') + 1)
        }
      emp_data.push(details);
      console.warn('added' , {emp_data} );
      const options ={
        method:"POST",
headers: {
 'Content-Type': 'application/json'

},
        body: JSON.stringify(details)
      };
      fetch('https://hr502.herokuapp.com/visiter', options)
      .then(function(response) {
        return response.json();
      }).then(function(text){
        console.log(text);
        let errString = ("Please enter following fields: \n");
        if(typeof(text.msg) === 'undefined' )
         {
          for(let err of text.errors){
          console.log(err.msg);
          errString += err.msg +", ";
        }
           alert(errString);
         }
         else{
           alert("verification mail is sent to Your Email");
         }
      })
 };
 document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('btn').addEventListener('click', add_emp);
 });

</script>

</body>
</html>
